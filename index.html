<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GREEN DOOR RPG - Ficha Completa</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --verde-neon: #4efc97;
      --verde-escuro: #0a2e1a;
      --verde-meio: #1e4530;
      --verde-claro: #3a9e5f;
      --preto: #0a0a0a;
      --branco: #e0f0e5;
      --sombra: rgba(0, 255, 100, 0.3);
      --destaque: #ffeb3b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(rgba(10, 30, 20, 0.9), rgba(10, 30, 20, 0.9));
      color: var(--branco);
      display: flex;
      min-height: 100vh;
    }

    /* Menu Lateral */
    .menu-lateral {
      width: 250px;
      background-color: var(--verde-escuro);
      border-right: 2px solid var(--verde-neon);
      padding: 20px;
      position: fixed;
      height: 100vh;
      z-index: 100;
    }

    .logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo img {
      max-width: 180px;
      filter: drop-shadow(0 0 5px var(--verde-neon));
    }

    .menu-item {
      padding: 12px 15px;
      margin: 8px 0;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Orbitron', sans-serif;
    }

    .menu-item:hover {
      background-color: var(--verde-meio);
    }

    .menu-item.ativo {
      background-color: var(--verde-claro);
      color: var(--preto);
      font-weight: bold;
    }

    /* Conte√∫do Principal */
    .conteudo {
      margin-left: 250px;
      flex: 1;
      padding: 30px;
    }

    /* Ficha Container */
    .ficha-container {
      max-width: 1000px;
      margin: 0 auto;
      background: rgba(10, 40, 20, 0.8);
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 0 30px var(--sombra);
      border: 1px solid var(--verde-neon);
    }

    h1, h2, h3 {
      font-family: 'Orbitron', sans-serif;
      color: var(--verde-neon);
      margin-bottom: 15px;
    }

    /* Informa√ß√µes do Jogador */
    .info-jogador {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .dados-jogador {
      flex: 1;
      min-width: 250px;
    }

    .avatar {
      width: 150px;
      height: 150px;
      border-radius: 8px;
      background: rgba(30, 70, 40, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 2px dashed var(--verde-neon);
    }

    .avatar img {
      max-width: 100%;
      max-height: 100%;
    }

    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
      color: var(--verde-neon);
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      background: rgba(30, 70, 40, 0.5);
      border: 1px solid var(--verde-neon);
      border-radius: 4px;
      color: var(--branco);
    }

    /* Estat√≠sticas */
    .estatisticas-container {
      display: flex;
      gap: 15px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .estatistica-item {
      flex: 1;
      min-width: 120px;
      text-align: center;
      padding: 10px;
      background: rgba(20, 50, 30, 0.6);
      border-radius: 8px;
      border-left: 3px solid var(--verde-neon);
    }

    .estatistica-valor {
      font-size: 1.5rem;
      font-weight: bold;
      margin-top: 5px;
      color: var(--verde-neon);
    }

    /* F√¥lego */
    .folego-container {
      margin-top: 15px;
    }

    .barra-folego {
      height: 10px;
      background: var(--verde-escuro);
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }

    .barra-folego-inner {
      height: 100%;
      background: var(--verde-neon);
      width: 100%;
      transition: width 0.3s ease;
    }

    /* Status da barra de f√¥lego */
    .folego-status {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 0.8rem;
    }

    /* Atributos e Per√≠cias */
    .grid-atributos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .card-atributo {
      background: rgba(20, 50, 30, 0.6);
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid var(--verde-neon);
    }

    .atributo-input {
      width: 60px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .pericia-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
      padding: 5px;
      background: rgba(30, 60, 40, 0.3);
      border-radius: 4px;
    }

    .pericia-nome {
      flex: 1;
    }

    .pericia-manual {
      width: 40px;
      text-align: center;
    }

    .pericia-total {
      min-width: 30px;
      text-align: center;
      font-weight: bold;
      color: var(--verde-neon);
    }

    /* Bot√µes */
    .btn-container {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      background: var(--verde-neon);
      color: var(--verde-escuro);
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .btn:hover {
      background: var(--branco);
      transform: translateY(-2px);
    }

    .btn-login {
      background: #4285F4;
      color: white;
    }

    /* Se√ß√µes EM BREVE */
    .em-breve {
      text-align: center;
      padding: 50px 20px;
      font-size: 2rem;
      color: var(--verde-neon);
      text-shadow: 0 0 10px var(--sombra);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-conteudo {
      background: var(--verde-escuro);
      border: 2px solid var(--verde-neon);
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      text-align: center;
    }

    .modal-botoes {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .menu-lateral {
        width: 100%;
        position: relative;
        height: auto;
      }
      
      .conteudo {
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <!-- Menu Lateral -->
  <div class="menu-lateral">
    <div class="logo">
      <img src="https://media.discordapp.net/attachments/1402279926987493437/1402435120287187066/31_Sem_Titulo2_20250719171917.png" alt="Green Door Logo">
    </div>
    
    <div class="menu-item ativo" onclick="mostrarSecao('ficha')">Minha Ficha</div>
    <div class="menu-item" onclick="mostrarSecao('ranking')">Rankings</div>
    <div class="menu-item" onclick="mostrarSecao('leilao')">Leil√£o</div>
    <div class="menu-item" onclick="mostrarSecao('mestre')">Painel do Mestre</div>
    <div class="menu-item" id="menu-login" onclick="login()">Entrar</div>
  </div>

  <!-- Modal de Login -->
  <div id="modal-login" class="modal">
    <div class="modal-conteudo">
      <h3>ENTRAR NO GREEN DOOR</h3>
      <p>Fa√ßa login para salvar sua ficha e acessar todos os recursos</p>
      <div class="modal-botoes">
        <button class="btn btn-login" onclick="fazerLoginGoogle()">Entrar com Google</button>
        <button class="btn" onclick="fecharLogin()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Conte√∫do Principal -->
  <div class="conteudo">
    <!-- Se√ß√£o da Ficha -->
    <div id="secao-ficha">
      <div class="ficha-container">
        <h1>FICHA DO JOGADOR</h1>
        
        <!-- Informa√ß√µes B√°sicas -->
        <div class="info-jogador">
          <div class="dados-jogador">
            <label for="nome">Nome do Personagem</label>
            <input type="text" id="nome" placeholder="Ex: Rin Itoshi">
            
            <label for="idade">Idade</label>
            <input type="number" id="idade" min="13" max="50" value="18">
            
            <label for="classe">Classe</label>
            <select id="classe">
              <option value="">Selecione sua classe...</option>
              <option value="padeiro">O Padeiro</option>
              <option value="soberano">Soberano dos Escarnecedores</option>
              <!-- [Todas as outras classes abaixo] -->
              <option value="ala">Ala Completo</option>
              <option value="cemiterio">Cemit√©rio de Talentos</option>
              <option value="devorador">O Devorador de √Ås</option>
              <option value="trivelinha">Trivelinha</option>
              <option value="entropia">Entropia Controlada</option>
              <option value="matador">O Matador de Ginga</option>
              <option value="duelista">O Duelista</option>
              <option value="as">√Ås Dominador</option>
              <option value="cacador">O Ca√ßador de Gols</option>
              <option value="instinto">Institivo</option>
              <option value="principe">Pr√≠ncipe do Drible</option>
              <option value="saltador">Atacante Saltador</option>
              <option value="playmaker">Playmaker</option>
              <option value="especialista">O Especialista Espacial</option>
              <option value="precisao">Ca√ßador de Precis√£o</option>
              <option value="vigia">Vigia</option>
              <option value="atacante">O Atacante Completo</option>
              <option value="driblador">O Driblador</option>
              <option value="magico">M√°gico</option>
              <option value="maestro">Maestro Magistral</option>
              <option value="estrategista">O Estrategista Prod√≠gio</option>
              <option value="ninja">O Ninja</option>
              <option value="controlador">O Atacante Controlador</option>
              <option value="planetario">O Planet√°rio</option>
              <option value="breakdance">Breakdance</option>
              <option value="velocista">Velocista</option>
              <option value="corvo">Corvo</option>
              <option value="goleiro">O Goleiro</option>
              <option value="genio">O G√™nio Indom√°vel</option>
              <option value="cachorro">O Cachorro Louco</option>
              <option value="molusco">Molusco Malicioso</option>
              <option value="elmaestro">El Maestro</option>
              <option value="dominador">Dominador Dimensional</option>
              <option value="clinico">Finalizador Cl√≠nico</option>
              <option value="imperador">O Imperador</option>
              <option value="defensor">O Defensor Espacial</option>
              <option value="relampago">Rel√¢mpago Roxo</option>
              <option value="gaviao">Gavi√£o</option>
              <option value="multifuncoes">O Multi-Fun√ß√µes</option>
              <option value="camisa9">Camisa 9</option>
              <option value="vilao">Vil√£o do Campo</option>
              <option value="trickster">Trickster</option>
              <option value="general">General √Ås</option>
              <option value="estamina">Louco por Estamina</option>
              <option value="paladino">O Paladino dos C√©us</option>
              <option value="ceifador">Ceifador Sombrio</option>
              <option value="arruaceiro">Arruaceiro</option>
              <option value="passador">O Passador Glacial</option>
            </select>
          </div>
          
          <div class="dados-jogador">
            <label for="posicao">Posi√ß√£o</label>
            <select id="posicao">
              <option value="goleiro">Goleiro</option>
              <option value="zagueiro">Zagueiro</option>
              <option value="lateral">Lateral</option>
              <option value="meia">Meia</option>
              <option value="atacante">Atacante</option>
            </select>
            
            <label for="altura">Altura (m)</label>
            <input type="number" id="altura" min="1.50" max="2.05" step="0.01" value="1.75">
            
            <label for="peso">Peso (kg)</label>
            <input type="number" id="peso" min="50" max="100" step="1" value="70">
          </div>
          
          <div class="dados-jogador">
            <label for="perna">Perna Dominante</label>
            <select id="perna">
              <option value="direita">Direita</option>
              <option value="esquerda">Esquerda</option>
              <option value="ambidestro">Ambidestro</option>
            </select>
            
            <label for="dom">Dom Natural</label>
            <select id="dom">
              <option value="nenhum">Nenhum</option>
              <option value="genio">G√™nio (+6 pontos em per√≠cias)</option>
              <option value="prodigo">Prod√≠gio (+6 pontos em atributos)</option>
            </select>
            
            <div class="folego-container">
              <label>F√¥lego (Atual/Total)</label>
              <div style="display: flex; align-items: center; gap: 5px;">
                <input type="number" id="folego-atual" min="0" value="10" style="width: 60px;">
                <span>/</span>
                <input type="number" id="folego-total" min="1" value="10" style="width: 60px;">
              </div>
              <div class="barra-folego">
                <div class="barra-folego-inner" id="barra-folego" style="width: 100%;"></div>
              </div>
              <div class="folego-status">
                <span id="folego-vazio">Vazio</span>
                <span id="folego-metade">Metade</span>
                <span id="folego-cheio">Cheio</span>
              </div>
            </div>
          </div>
          
          <div class="avatar">
            <img id="avatar-img" src="" alt="Avatar" style="display: none;">
            <span>Sem imagem</span>
          </div>
        </div>
        
        <!-- Estat√≠sticas -->
        <div class="estatisticas-container">
          <div class="estatistica-item">
            <span>‚öΩ Gols</span>
            <input type="number" id="gols" min="0" value="0" class="estatistica-valor">
          </div>
          
          <div class="estatistica-item">
            <span>üëü Assist√™ncias</span>
            <input type="number" id="assistencias" min="0" value="0" class="estatistica-valor">
          </div>
          
          <div class="estatistica-item" id="sg-container" style="display:none;">
            <span>üõ°Ô∏è SG</span>
            <input type="number" id="sg" min="0" value="0" class="estatistica-valor">
          </div>
          
          <div class="estatistica-item">
            <span>üèÉ‚Äç‚ôÇÔ∏è Deslocamento</span>
            <input type="number" id="deslocamento" min="0" value="10" class="estatistica-valor" readonly>
          </div>
        </div>
        
        <!-- Upload de Avatar -->
        <div style="text-align: center; margin-bottom: 20px;">
          <input type="file" id="avatar-input" accept="image/*">
        </div>

        <!-- Atributos e Per√≠cias -->
        <h2>ATRIBUTOS E PER√çCIAS</h2>
        <div class="grid-atributos">
          <!-- POT√äNCIA -->
          <div class="card-atributo">
            <h3>üí™ POT√äNCIA</h3>
            <input type="number" id="potencia" class="atributo-input" min="-50" max="50" value="0">
            
            <div class="pericia-item">
              <span class="pericia-nome">Corpo a Corpo</span>
              <input type="number" class="pericia-manual" data-pericia="corpo" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="corpo">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Cabeceio</span>
              <input type="number" class="pericia-manual" data-pericia="cabeceio" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="cabeceio">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Chute</span>
              <input type="number" class="pericia-manual" data-pericia="chute" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="chute">0</span>
            </div>
          </div>
          
          <!-- T√âCNICA -->
          <div class="card-atributo">
            <h3>‚öΩ T√âCNICA</h3>
            <input type="number" id="tecnica" class="atributo-input" min="-50" max="50" value="0">
            
            <div class="pericia-item">
              <span class="pericia-nome">Passe</span>
              <input type="number" class="pericia-manual" data-pericia="passe" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="passe">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Drible/Finta</span>
              <input type="number" class="pericia-manual" data-pericia="drible" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="drible">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Dom√≠nio</span>
              <input type="number" class="pericia-manual" data-pericia="dominio" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="dominio">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Pontaria</span>
              <input type="number" class="pericia-manual" data-pericia="pontaria" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="pontaria">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Roubo de Bola</span>
              <input type="number" class="pericia-manual" data-pericia="roubo" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="roubo">0</span>
            </div>
          </div>
          
          <!-- VELOCIDADE -->
          <div class="card-atributo">
            <h3>üèÉ VELOCIDADE</h3>
            <input type="number" id="velocidade" class="atributo-input" min="-50" max="50" value="0">
            
            <div class="pericia-item">
              <span class="pericia-nome">Corrida Longa Dist√¢ncia</span>
              <input type="number" class="pericia-manual" data-pericia="corrida" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="corrida">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Explos√£o</span>
              <input type="number" class="pericia-manual" data-pericia="explosao" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="explosao">0</span>
            </div>
          </div>
          
          <!-- AGILIDADE -->
          <div class="card-atributo">
            <h3>ü•ã AGILIDADE</h3>
            <input type="number" id="agilidade" class="atributo-input" min="-50" max="50" value="0">
            
            <div class="pericia-item">
              <span class="pericia-nome">Reflexos</span>
              <input type="number" class="pericia-manual" data-pericia="reflexos" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="reflexos">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Defesa</span>
              <input type="number" class="pericia-manual" data-pericia="defesa" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="defesa">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Furtividade</span>
              <input type="number" class="pericia-manual" data-pericia="furtividade" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="furtividade">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Acrobacia</span>
              <input type="number" class="pericia-manual" data-pericia="acrobacia" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="acrobacia">0</span>
            </div>
          </div>
          
          <!-- EGO -->
          <div class="card-atributo">
            <h3>üíé EGO</h3>
            <input type="number" id="ego" class="atributo-input" min="-50" max="50" value="0">
            
            <div class="pericia-item">
              <span class="pericia-nome">Intimida√ß√£o</span>
              <input type="number" class="pericia-manual" data-pericia="intimidacao" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="intimidacao">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Presen√ßa</span>
              <input type="number" class="pericia-manual" data-pericia="presenca" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="presenca">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Engana√ß√£o</span>
              <input type="number" class="pericia-manual" data-pericia="enganacao" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="enganacao">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Diplomacia</span>
              <input type="number" class="pericia-manual" data-pericia="diplomacia" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="diplomacia">0</span>
            </div>
            
            <div class="pericia-item">
              <span class="pericia-nome">Intui√ß√£o</span>
              <input type="number" class="pericia-manual" data-pericia="intuicao" min="-10" max="5" value="0">
              <span class="pericia-total" data-pericia="intuicao">0</span>
            </div>
          </div>
        </div>
        
        <!-- Habilidades e Bot√µes -->
        <div style="margin-top: 30px;">
          <h3>HABILIDADES ESPECIAIS</h3>
          <textarea id="habilidades" style="width: 100%; min-height: 100px;" placeholder="Descreva as habilidades especiais do seu personagem..."></textarea>
        </div>
        
        <div class="btn-container">
          <button class="btn" onclick="calcularPericias()">CALCULAR PER√çCIAS</button>
          <button class="btn" onclick="salvarFicha()">SALVAR FICHA</button>
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o Ranking -->
    <div id="secao-ranking" style="display: none;">
      <div class="ficha-container">
        <div class="em-breve">
          <h1>RANKING</h1>
          <p>EM BREVE</p>
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o Leil√£o -->
    <div id="secao-leilao" style="display: none;">
      <div class="ficha-container">
        <div class="em-breve">
          <h1>LEIL√ÉO</h1>
          <p>EM BREVE</p>
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o Painel do Mestre -->
    <div id="secao-mestre" style="display: none;">
      <div class="ficha-container">
        <h1>PAINEL DO MESTRE</h1>
        <div id="lista-fichas" style="margin-top: 20px;">
          <!-- As fichas ser√£o carregadas aqui -->
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para escolha de ambidestro -->
  <div id="modal-ambidestro" class="modal">
    <div class="modal-conteudo">
      <h3>ESCOLHA DE AMBIDESTRO</h3>
      <p>Voc√™ selecionou Ambidestro. Escolha onde aplicar seu b√¥nus adicional:</p>
      <div class="modal-botoes">
        <button class="btn" onclick="escolherAmbidestro('pontaria')">+5 Pontaria</button>
        <button class="btn" onclick="escolherAmbidestro('chute')">+5 Chute</button>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Tabelas de b√¥nus de altura/peso (COMPLETAS)
    const bonusAltura = {
      '1.50-1.55': { drible: 3, explosao: 2, reflexos: 2, cabeceio: -3, intimidacao: -2, defesa: -2 },
      '1.56-1.60': { drible: 2, explosao: 2, reflexos: 2, cabeceio: -3, intimidacao: -2, defesa: -1 },
      '1.61-1.65': { drible: 2, explosao: 1, reflexos: 2, cabeceio: -2, intimidacao: -1, defesa: -1 },
      '1.66-1.70': { drible: 2, explosao: 1, reflexos: 1, cabeceio: -2, defesa: -1 },
      '1.71-1.75': { drible: 1, reflexos: 1, cabeceio: -1 },
      '1.76-1.80': {},
      '1.81-1.85': { cabeceio: 1, intimidacao: 1, defesa: 1, explosao: -1 },
      '1.86-1.90': { cabeceio: 2, intimidacao: 1, defesa: 2, explosao: -2 },
      '1.91-1.95': { cabeceio: 2, intimidacao: 2, defesa: 2, explosao: -2, drible: -1 },
      '1.96-2.00': { cabeceio: 3, intimidacao: 2, defesa: 3, explosao: -3, drible: -2, reflexos: -1 },
      '2.01-2.05': { cabeceio: 3, intimidacao: 3, defesa: 4, explosao: -4, drible: -2, reflexos: -2 }
    };

    const bonusPeso = {
      '50-55': { explosao: 3, acrobacia: 2, furtividade: 2, reflexos: 1, corpo: -3, intimidacao: -2, defesa: -2 },
      '56-60': { explosao: 2, acrobacia: 2, furtividade: 1, reflexos: 1, corpo: -3, intimidacao: -2, defesa: -1 },
      '61-65': { explosao: 2, acrobacia: 1, furtividade: 1, reflexos: 1, corpo: -2, intimidacao: -1 },
      '66-70': { explosao: 2, acrobacia: 1, reflexos: 1, corpo: -2 },
      '71-75': {},
      '76-80': { corpo: 1, chute: 1, defesa: 1, explosao: -1 },
      '81-85': { corpo: 2, chute: 1, defesa: 1, explosao: -2, reflexos: -1 },
      '86-90': { corpo: 2, chute: 2, defesa: 2, explosao: -2, reflexos: -1 },
      '91-95': { corpo: 3, chute: 2, defesa: 3, explosao: -3, reflexos: -2 },
      '96-100': { corpo: 3, chute: 3, defesa: 4, explosao: -4, reflexos: -2, drible: -1 }
    };

    // Vari√°veis globais
    let escolhaAmbidestro = ''; // Armazena a escolha do jogador (pontaria ou chute)
    let fichaId = ''; // Armazena o ID da ficha no Firestore

    // Fun√ß√£o para identificar intervalo
    function getBonus(value, table) {
      const numValue = Number(value);
      if (isNaN(numValue)) return {};
      
      for (const range in table) {
        const [minStr, maxStr] = range.split('-');
        const min = Number(minStr);
        const max = Number(maxStr);
        
        if (numValue >= min && numValue <= max) {
          return table[range] || {};
        }
      }
      return {};
    }

    // Atualizar barra de f√¥lego
    function atualizarBarraFolego() {
      const atual = parseInt(document.getElementById('folego-atual').value) || 0;
      const total = parseInt(document.getElementById('folego-total').value) || 1;
      const porcentagem = Math.min(100, (atual / total) * 100);
      const barra = document.getElementById('barra-folego');
      
      // Atualizar largura da barra
      barra.style.width = `${porcentagem}%`;
      
      // Atualizar status visual
      const statusVazio = document.getElementById('folego-vazio');
      const statusMetade = document.getElementById('folego-metade');
      const statusCheio = document.getElementById('folego-cheio');
      
      // Resetar todos
      statusVazio.style.color = '';
      statusMetade.style.color = '';
      statusCheio.style.color = '';
      
      // Destacar o status atual
      if (porcentagem <= 25) {
        statusVazio.style.color = '#ff0000';
        statusVazio.style.fontWeight = 'bold';
      } else if (porcentagem <= 75) {
        statusMetade.style.color = '#ffcc00';
        statusMetade.style.fontWeight = 'bold';
      } else {
        statusCheio.style.color = '#00ff00';
        statusCheio.style.fontWeight = 'bold';
      }
    }

    // Calcular todas as per√≠cias
    function calcularPericias() {
      const altura = parseFloat(document.getElementById('altura').value) || 1.75;
      const peso = parseInt(document.getElementById('peso').value) || 70;
      const perna = document.getElementById('perna').value;
      const posicao = document.getElementById('posicao').value;

      const bonusA = getBonus(altura, bonusAltura);
      const bonusP = getBonus(peso, bonusPeso);

      // Fun√ß√£o para ajustar b√¥nus de defesa para n√£o goleiros
      function ajustarDefesa(bonus) {
        if (posicao !== 'goleiro') {
          if (bonus.defesa && (altura >= 1.86 || peso >= 86)) {
            bonus.defesa = Math.floor(bonus.defesa / 2);
          }
        }
        return bonus;
      }

      // Aplicar ajustes
      const bonusAjustadoA = ajustarDefesa({...bonusA});
      const bonusAjustadoP = ajustarDefesa({...bonusP});

      document.querySelectorAll('.pericia-item').forEach(item => {
        const periciaId = item.querySelector('.pericia-manual').dataset.pericia;
        const card = item.closest('.card-atributo');
        const atributoId = card.querySelector('.atributo-input').id;
        const valorAtributo = parseInt(document.getElementById(atributoId).value) || 0;

        // C√°lculo base (metade do atributo)
        let valor = Math.floor(valorAtributo / 2);

        // Aplicar b√¥nus de altura/peso
        if (bonusAjustadoA[periciaId]) valor += bonusAjustadoA[periciaId];
        if (bonusAjustadoP[periciaId]) valor += bonusAjustadoP[periciaId];

        // Aplicar ambidestria
        if (perna === 'ambidestro') {
          // B√¥nus padr√£o para todas as per√≠cias
          if (['passe','drible','dominio','roubo'].includes(periciaId)) {
            valor += 5;
          }
          
          // B√¥nus adicional na escolha
          if ((periciaId === 'pontaria' && escolhaAmbidestro === 'pontaria') || 
              (periciaId === 'chute' && escolhaAmbidestro === 'chute')) {
            valor += 5;
          }
        }

        // Atualizar total
        const pontosManuais = parseInt(item.querySelector('.pericia-manual').value) || 0;
        item.querySelector('.pericia-total').textContent = valor + pontosManuais;
      });

      // Atualizar deslocamento (10 + velocidade)
      const velocidade = parseInt(document.getElementById('velocidade').value) || 0;
      document.getElementById('deslocamento').value = 10 + velocidade;
    }

    // Mostrar/ocultar campo SG conforme a posi√ß√£o
    function atualizarCamposPosicao() {
      const posicao = document.getElementById('posicao').value;
      const sgContainer = document.getElementById('sg-container');
      
      if (posicao === 'goleiro' || posicao === 'zagueiro') {
        sgContainer.style.display = 'block';
      } else {
        sgContainer.style.display = 'none';
      }
    }

    // Upload de avatar
    document.getElementById('avatar-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const img = document.getElementById('avatar-img');
          img.src = event.target.result;
          img.style.display = 'block';
          document.querySelector('.avatar span').style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    });

    // Mostrar modal de escolha para ambidestro
    document.getElementById('perna').addEventListener('change', function() {
      if (this.value === 'ambidestro' && !escolhaAmbidestro) {
        document.getElementById('modal-ambidestro').style.display = 'flex';
      } else {
        calcularPericias();
      }
    });

    // Escolher op√ß√£o para ambidestro
    function escolherAmbidestro(escolha) {
      escolhaAmbidestro = escolha;
      document.getElementById('modal-ambidestro').style.display = 'none';
      calcularPericias();
    }

    // Trocar se√ß√µes
    function mostrarSecao(secao) {
      // Esconder todas as se√ß√µes
      document.querySelectorAll('.conteudo > div').forEach(el => {
        el.style.display = 'none';
      });
      
      // Mostrar a se√ß√£o selecionada
      document.getElementById(`secao-${secao}`).style.display = 'block';
      
      // Atualizar menu ativo
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('ativo');
      });
      document.querySelector(`.menu-item[onclick="mostrarSecao('${secao}')"]`).classList.add('ativo');
      
      // Carregar fichas se for o painel do mestre
      if (secao === 'mestre') {
        carregarFichasParaMestre();
      }
    }

    // Salvar ficha no Firebase
    async function salvarFicha() {
      const user = auth.currentUser;
      if (!user) {
        abrirLogin();
        alert('Voc√™ precisa fazer login para salvar sua ficha!');
        return;
      }
      
      // Coletar dados da ficha
      const ficha = {
        nome: document.getElementById('nome').value,
        idade: document.getElementById('idade').value,
        classe: document.getElementById('classe').value,
        posicao: document.getElementById('posicao').value,
        altura: document.getElementById('altura').value,
        peso: document.getElementById('peso').value,
        perna: document.getElementById('perna').value,
        escolhaAmbidestro: escolhaAmbidestro,
        dom: document.getElementById('dom').value,
        folegoAtual: document.getElementById('folego-atual').value,
        folegoTotal: document.getElementById('folego-total').value,
        gols: document.getElementById('gols').value,
        assistencias: document.getElementById('assistencias').value,
        sg: document.getElementById('sg').value,
        deslocamento: document.getElementById('deslocamento').value,
        avatar: document.getElementById('avatar-img').src || '',
        pericias: {}
      };

      // Coletar atributos
      const atributos = ['potencia', 'tecnica', 'velocidade', 'agilidade', 'ego'];
      atributos.forEach(attr => {
        ficha[attr] = parseInt(document.getElementById(attr).value) || 0;
      });

      // Coletar per√≠cias
      document.querySelectorAll('.pericia-item').forEach(item => {
        const periciaId = item.querySelector('.pericia-manual').dataset.pericia;
        const manual = parseInt(item.querySelector('.pericia-manual').value) || 0;
        const total = parseInt(item.querySelector('.pericia-total').textContent) || 0;
        
        ficha.pericias[periciaId] = {
          manual: manual,
          total: total
        };
      });
      
      // Salvar no Firestore
      try {
        if (fichaId) {
          // Atualizar ficha existente
          await db.collection('fichas').doc(fichaId).update(ficha);
        } else {
          // Criar nova ficha
          const docRef = await db.collection('fichas').add({
            ...ficha,
            userId: user.uid,
            criadoEm: firebase.firestore.FieldValue.serverTimestamp()
          });
          fichaId = docRef.id;
        }
        alert('Ficha salva com sucesso!');
      } catch (error) {
        console.error('Erro ao salvar ficha:', error);
        alert('Erro ao salvar ficha: ' + error.message);
      }
    }

    // Carregar ficha do usu√°rio
    async function carregarFichaDoUsuario() {
      const user = auth.currentUser;
      if (!user) return;
      
      try {
        const snapshot = await db.collection('fichas')
          .where('userId', '==', user.uid)
          .limit(1)
          .get();
          
        if (!snapshot.empty) {
          const doc = snapshot.docs[0];
          fichaId = doc.id;
          const ficha = doc.data();
          
          // Preencher campos b√°sicos
          document.getElementById('nome').value = ficha.nome || '';
          document.getElementById('idade').value = ficha.idade || 18;
          document.getElementById('classe').value = ficha.classe || '';
          document.getElementById('posicao').value = ficha.posicao || 'goleiro';
          document.getElementById('altura').value = ficha.altura || 1.75;
          document.getElementById('peso').value = ficha.peso || 70;
          document.getElementById('perna').value = ficha.perna || 'direita';
          escolhaAmbidestro = ficha.escolhaAmbidestro || '';
          document.getElementById('dom').value = ficha.dom || 'nenhum';
          document.getElementById('folego-atual').value = ficha.folegoAtual || 10;
          document.getElementById('folego-total').value = ficha.folegoTotal || 10;
          document.getElementById('gols').value = ficha.gols || 0;
          document.getElementById('assistencias').value = ficha.assistencias || 0;
          document.getElementById('sg').value = ficha.sg || 0;
          document.getElementById('deslocamento').value = ficha.deslocamento || 10;
          
          // Avatar
          if (ficha.avatar) {
            const img = document.getElementById('avatar-img');
            img.src = ficha.avatar;
            img.style.display = 'block';
            document.querySelector('.avatar span').style.display = 'none';
          }
          
          // Atributos
          atributos.forEach(attr => {
            document.getElementById(attr).value = ficha[attr] || 0;
          });
          
          // Per√≠cias
          for (const [periciaId, valores] of Object.entries(ficha.pericias || {})) {
            const manualInput = document.querySelector(`.pericia-manual[data-pericia="${periciaId}"]`);
            const totalSpan = document.querySelector(`.pericia-total[data-pericia="${periciaId}"]`);
            
            if (manualInput) manualInput.value = valores.manual;
            if (totalSpan) totalSpan.textContent = valores.total;
          }
          
          // Atualizar campos dependentes
          atualizarCamposPosicao();
          atualizarBarraFolego();
        }
      } catch (error) {
        console.error('Erro ao carregar ficha:', error);
      }
    }

    // Carregar fichas para o painel do mestre
    async function carregarFichasParaMestre() {
      try {
        const snapshot = await db.collection('fichas').get();
        const listaFichas = document.getElementById('lista-fichas');
        listaFichas.innerHTML = '';
        
        if (snapshot.empty) {
          listaFichas.innerHTML = '<p>Nenhuma ficha encontrada</p>';
          return;
        }
        
        snapshot.forEach(doc => {
          const ficha = doc.data();
          const fichaEl = document.createElement('div');
          fichaEl.className = 'card-atributo';
          fichaEl.innerHTML = `
            <h3>${ficha.nome || 'Sem nome'}</h3>
            <p><strong>Classe:</strong> ${ficha.classe || '-'}</p>
            <p><strong>Posi√ß√£o:</strong> ${ficha.posicao || '-'}</p>
            <p><strong>Gols:</strong> ${ficha.gols || 0} | <strong>Assist√™ncias:</strong> ${ficha.assistencias || 0}</p>
          `;
          listaFichas.appendChild(fichaEl);
        });
      } catch (error) {
        console.error('Erro ao carregar fichas:', error);
        alert('Erro ao carregar fichas: ' + error.message);
      }
    }

    // Fun√ß√µes de login
    function abrirLogin() {
      document.getElementById('modal-login').style.display = 'flex';
    }

    function fecharLogin() {
      document.getElementById('modal-login').style.display = 'none';
    }

    async function fazerLoginGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        await auth.signInWithPopup(provider);
        fecharLogin();
      } catch (error) {
        alert('Erro no login com Google: ' + error.message);
      }
    }

    function login() {
      abrirLogin();
    }

    // Logout
    function logout() {
      auth.signOut();
      window.location.reload();
    }

    // Atualizar menu de login/logout conforme o estado
    auth.onAuthStateChanged(user => {
      const menuLogin = document.getElementById('menu-login');
      if (user) {
        menuLogin.textContent = 'Sair';
        menuLogin.onclick = logout;
        menuLogin.style.background = '#d9534f';
        carregarFichaDoUsuario();
      } else {
        menuLogin.textContent = 'Entrar';
        menuLogin.onclick = login;
        menuLogin.style.background = '';
      }
    });

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar Firebase Auth
      auth.onAuthStateChanged(user => {
        if (user) {
          // Usu√°rio logado
          console.log('Usu√°rio logado:', user.uid);
          carregarFichaDoUsuario();
        }
      });
      
      // Inicializar componentes
      atualizarBarraFolego();
      atualizarCamposPosicao();
      calcularPericias();
      
      // Event listeners
      document.getElementById('altura').addEventListener('change', calcularPericias);
      document.getElementById('peso').addEventListener('change', calcularPericias);
      document.getElementById('perna').addEventListener('change', calcularPericias);
      document.getElementById('folego-atual').addEventListener('input', atualizarBarraFolego);
      document.getElementById('folego-total').addEventListener('input', atualizarBarraFolego);
      document.getElementById('posicao').addEventListener('change', atualizarCamposPosicao);
      
      // Event listeners para atributos
      const atributos = ['potencia', 'tecnica', 'velocidade', 'agilidade', 'ego'];
      atributos.forEach(attr => {
        document.getElementById(attr).addEventListener('input', calcularPericias);
      });
      
      // Event listeners para per√≠cias manuais
      document.querySelectorAll('.pericia-manual').forEach(input => {
        input.addEventListener('input', calcularPericias);
      });
    });
  </script>
</body>
</html>
